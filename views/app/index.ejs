<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>MAIN CHAT</title>
  </head>
  <body>
    <h2>MAIN CHAT</h2>
    <ul id="messages"></ul>
    <!-- <%for(let i = 0; i < messages.length; i++){%>
      <%=messages[i].name%> : <%=messages[i].message%><br>
    <%}%> -->
    <form id="message-form" action="" method=""> <!-- /app, POST -->
      <input placeholder="Message..." id="message" autocomplete="off">
      <button type="submit" id="submit">SEND</button>
    </form>
    <script src="/socket.io/socket.io.js"></script>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script>
      $(()=>{
        console.log('im running client function');
        let socket = io.connect();
        $('form').on('submit', (event)=>{
          console.log('im emiting message');
          event.preventDefault();
          socket.emit('chat message', $('#message').val());
          $('#messages').append($('<li>').text($('#message').val()));
          return false;
        });
        socket.on('emitting', (message)=>{
          console.log('im receiving message back');
          $('#messages').append($('<li>').text(message));
          window.scrollTo(0, document.body.scrollHeight);
        });
      });
    </script>
  </body>
</html>
